'use strict';

const logging = require('@sap/logging');
const appContext = logging.createAppContext();
const SENSITIVE_FIELDS = ['authorization', 'bearer', 'clientsecret', 'credentials', 'req'];

function getLogger(category) {
  return appContext.createLogContext({ id: '' }).getLogger(category);
}

function getMiddleware() {
  return logging.middleware({ appContext });
}

function loggify(data, sensitiveFields = SENSITIVE_FIELDS) {
  return JSON.stringify(data, (key, value) => {
    const lowerCaseKey = key.toLowerCase();
    if (sensitiveFields.includes(lowerCaseKey)) {
      const replaceValue = (lowerCaseKey === 'authorization' ? 'Bearer ' : '') + '[HIDDEN DATA]';
      return replaceValue;
    }
    return value;
  }, 2);
}

module.exports = { getLogger, getMiddleware, loggify };
