'use strict';

const auditlog = require('@sap/audit-logging');

class AuditLogger {
  constructor(credentials, cb) {
    auditlog.v2(credentials, (err, audit) => {
      if (err) {
        this.auditClient = auditlog(credentials);
      } else {
        this.auditClient = audit;
      }
      cb();
    });
  }

  logSecurityEvent(message, user, ip, callback) {
    if (!this.auditClient) {
      return process.nextTick(callback.bind(null, 'Auditlog is not initialized'));
    }
    this.auditClient.securityMessage(message)
      .by(user)
      .externalIP(ip)
      .log(err => callback(err));
  }
}

module.exports = {
  initialize: (credentials, cb) => new AuditLogger(credentials, cb)
};
