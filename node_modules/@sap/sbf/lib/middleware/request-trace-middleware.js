'use strict';

const _ = require('lodash');

module.exports = function requestTrace(req, res, next) {
  const tracer = req.loggingContext.getTracer(__filename);
  if (tracer.isEnabled('debug')) {
    // shallow copy because we don't want to deep clone eventually a big parameters object
    let clonedBody = _.clone(req.body);
    // parameters might contain sensitive information
    clonedBody.parameters = clonedBody.parameters && '<filtered>';
    tracer.debug(`${req.method} request to Service Broker path ${req.url} was made with body ${JSON.stringify(clonedBody, null, 2)}`);
  }
  next();
};
